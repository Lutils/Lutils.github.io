<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Hibernate | Lutils</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="关系数据库ORM框架">
<meta property="og:type" content="article">
<meta property="og:title" content="Hibernate">
<meta property="og:url" content="http://lutils.cn/2016/12/11/hibernate/index.html">
<meta property="og:site_name" content="Lutils">
<meta property="og:description" content="关系数据库ORM框架">
<meta property="og:updated_time" content="2016-12-23T14:39:18.544Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hibernate">
<meta name="twitter:description" content="关系数据库ORM框架">
  
    <link rel="alternative" href="/atom.xml" title="Lutils" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="\assets\img\headimg.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Lutils</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/comments.html">留言板</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Lutils" title="github">github</a>
		        
					<a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=SSU8PSAlOgk4OGcqJiQ" title="mail">mail</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Lutils</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="\assets\img\headimg.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Lutils</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/comments.html">留言板</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Lutils" title="github">github</a>
			        
						<a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=SSU8PSAlOgk4OGcqJiQ" title="mail">mail</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-hibernate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hibernate
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>关系数据库ORM框架<br><a id="more"></a></p>
<blockquote>
<p>配置文件</p>
</blockquote>
<h3 id="hibernate-cfg-xml"><a href="#hibernate-cfg-xml" class="headerlink" title="hibernate.cfg.xml"></a>hibernate.cfg.xml</h3><p>核心配置文件,基本配置如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></div><div class="line">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</div><div class="line">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库基本配置 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/mydb<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 控制台输出sql语句 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 是否格式化sql语句 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 自动生成表结构 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库方言配置 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 引入ORM 映射文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/ljc/bean/User.hbm.xml"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="hbm-xml"><a href="#hbm-xml" class="headerlink" title="*.hbm.xml"></a>*.hbm.xml</h3><p>bean映射文件,与javabean放在同一个包下,*为bean的名称,如User.hbm.xml,基本配置如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></div><div class="line">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="comment">&lt;!-- 表对象关系映射文件 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.ljc.bean"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 主键生成策略 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>常用Api</p>
</blockquote>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>构造:        //无参的configure()默认加载src根目录下的hibernate.cfg.xml,有参的为加载指定目录<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Configuration config = <span class="keyword">new</span> Configuration().configure();</div></pre></td></tr></table></figure></p>
<h3 id="SessionFactory"><a href="#SessionFactory" class="headerlink" title="SessionFactory"></a>SessionFactory</h3><p>类似于JDBC连接池,用于管理所有session<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SessionFactory sessionFactory = config.buildSessionFactory();</div></pre></td></tr></table></figure></p>
<p>sessionFactory缓存配置信息:数据库配置信息、映射文件、预定义HQL语句 等<br>其线程安全,可以是成员变量,多个线程同时访问时,不会出现线程并发访问问题。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获得新的session</span></div><div class="line">sessionFactory.openSession();</div><div class="line"><span class="comment">//获得当前线程中绑定的session</span></div><div class="line">sessionFactory.getCurrentSession();</div></pre></td></tr></table></figure></p>
<p>getCurrentSession在事务提交或者回滚之后会自动关闭,而openSession需手动关闭<br>如果使用openSession而没有手动关闭,多次之后会导致连接池溢出<br>openSession每次创建新的session对象，getCurrentSession使用现有的session对象(单例)</p>
<p>hibernate支持将创建的session绑定到本地线程中,底层使用ThreadLocal,在程序之间共享session<br>但必须在hibernate.cfg.xml 配置以下属性才可使用getCurrentSession()<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>类似于JDBC的Connection,实现数据库的增删改查,单线程,线程不安全,不能编写成员变量</p>
<p>插入操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建对象</span></div><div class="line">User user = <span class="keyword">new</span> User();</div><div class="line">user.setId(<span class="number">123</span>);</div><div class="line">user.setName(<span class="string">"LJC"</span>);</div><div class="line">user.setPassword(<span class="string">"123456"</span>);</div><div class="line"><span class="comment">//保存</span></div><div class="line">session.save(user);</div></pre></td></tr></table></figure>
<p>删除操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过id查询出要删除的对象</span></div><div class="line">User user = (User) session.get(User.class,<span class="number">1</span>);</div><div class="line"><span class="comment">//删除</span></div><div class="line">session.delete(user);</div></pre></td></tr></table></figure>
<p>更新操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 通过id查询出要修改的对象</span></div><div class="line">User user = (User) session.get(User.class, <span class="number">1</span>);</div><div class="line"><span class="comment">// 在查询结果上,进行修改</span></div><div class="line">user.setName(<span class="string">"ljc"</span>);</div><div class="line"><span class="comment">//更新</span></div><div class="line">session.update(user);</div></pre></td></tr></table></figure>
<p>查询操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//get方式通过id查询(方法被调用时立刻发送sql语句查询)</span></div><div class="line">User user1 = (User) session.get(User.class,<span class="number">1</span>);</div><div class="line"><span class="comment">//load方式通过id查询(调用时并没有查询数据库,返回代理对象/懒加载,当需要使用该对象的时候,才查询数据)</span></div><div class="line">User user2 = (User) session.load(User.class,<span class="number">1</span>);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//HQL方式</span></div><div class="line">Query query = session.createQuery(<span class="string">"from com.ljc.bean.User"</span>);</div><div class="line">List&lt;User&gt; list =  query.list();</div><div class="line"><span class="comment">//Criteria方式</span></div><div class="line">Criteria criteria = session.createCriteria(User.class);</div><div class="line">List&lt;User&gt; list1 = criteria.list();</div><div class="line">		</div><div class="line"><span class="comment">//原生sql方式</span></div><div class="line">SQLQuery query1 = session.createSQLQuery(<span class="string">"select * from user"</span>);</div><div class="line"><span class="comment">// addEntity 将查询结果封装到指定对象中</span></div><div class="line">query1.addEntity(User.class);</div><div class="line">List&lt;User&gt; list2 = query.list();</div></pre></td></tr></table></figure>
<h3 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//打开事务</span></div><div class="line">Transaction ts = session.beginTransaction();</div><div class="line"><span class="comment">//提交事务</span></div><div class="line">ts.commit();</div><div class="line"><span class="comment">//回滚事务</span></div><div class="line">ts.rollback();</div><div class="line"><span class="comment">//获得已经打开的事务对象</span></div><div class="line">session.getTransaction();</div></pre></td></tr></table></figure>
<p>如果提交或回滚事务,底层将自动关闭session</p>
<h3 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h3><p>封装HQL语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//封装HQL</span></div><div class="line">Query query = session.createQuery(<span class="string">"from com.ljc.bean.User"</span>);</div><div class="line"><span class="comment">//将HQL语句执行,并返回结果(多行)</span></div><div class="line">query.list();</div><div class="line"><span class="comment">//将HQL语句执行,并返回结果(一行)</span></div><div class="line">query.uniqueResult();</div><div class="line"><span class="comment">//分页 </span></div><div class="line"><span class="comment">//开始索引数startIndex</span></div><div class="line">query.setFirstResult(<span class="number">0</span>);</div><div class="line"><span class="comment">//每页显示个数 pageSize</span></div><div class="line">query.setMaxResults(<span class="number">2</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>多表映射</p>
</blockquote>
<h3 id="一对多-多对一"><a href="#一对多-多对一" class="headerlink" title="一对多/多对一"></a>一对多/多对一</h3><ol>
<li>一对多</li>
</ol>
<p>数据库：通过添加主外键的关联,表现一对多的关系(在多的一方加入外键,引用一的一方的主键)<br>代码中：通过在一方持有多方的集合实现,即在”一”的一端中使用<set>元素表示持有”多”的一端的对象</set></p>
<ol>
<li>多对一</li>
</ol>
<p>多对一的关系和关系数据库中的外键参照关系最匹配，即在己方(多方)表中的一个外键参照另一个表的主键<br>通过在多方持有一方的引用实现,需要在”多”的一端使用<many-to-one>配置</many-to-one></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">一方:</div><div class="line">	<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"集合属性名"</span> &gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"外键名"</span> /&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"多的一方的类型"</span>  /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">多方:</div><div class="line">	<span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"属性名"</span> <span class="attr">column</span>=<span class="string">"外键名"</span> <span class="attr">class</span>=<span class="string">"一的一方类型"</span> /&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>inverse</li>
</ol>
<p>表示反转,是<set>节点的一个属性(用来指定关联关系的维护),可以指定关联关系的方向,默认值为false(不反转)<br>//即表示一的一方要不要放弃维护外键关系<br>1、一方的hbm.xml文件的<set>节点的inverse属性指定了关联关系的控制方向,默认由one方来维护<br>2、关联关系中,inverse=”false”则为主动方,由主动方负责维护关联关系<br>3、在一对多关联中,设置one方的inverse为true,这将有助于性能的改善<br>4、只存在于集合标记的元素中,Hibernate提供的集合元素包括<set> <map> <list> <array> <bag><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置单向一对多关系,设置inverse为true,由多方进行关联关系的维护 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"stu"</span> <span class="attr">table</span>=<span class="string">"stu"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 指定关联的外键列 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"gid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.entity.Student"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></bag></array></list></map></set></set></set></p>
<ol>
<li>cascade</li>
</ol>
<p>级联操作<br>1、当设置了cascade属性不为none时,Hibernate会自动持久化所关联的对象<br>2、cascade属性的设置会带来性能上的变动,需要谨慎设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">属性值               含义和作用</div><div class="line">all            对所有操作进行级联操作</div><div class="line">save-update    执行保存和更新操作时进行级联操作</div><div class="line">delete         执行删除时进行级联操作</div><div class="line">none           对所有操作不进行级联操作</div></pre></td></tr></table></figure></p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>数据库:使用中间表,分别引用两方的ID<br>对象: 两方都使用set集合表达<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"courses"</span> <span class="attr">table</span>=<span class="string">"t_student_course"</span>  &gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"sid"</span> &gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Course"</span> <span class="attr">column</span>=<span class="string">"cid"</span> &gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>加载策略/优化查询</p>
</blockquote>
<p>策略种类:延迟加载、立即加载<br>策略的应用:类级别的加载策略、关联级别的加载策略</p>
<h3 id="类级别加载策略"><a href="#类级别加载策略" class="headerlink" title="类级别加载策略"></a>类级别加载策略</h3><p>即get与load方法查询数据的方式<br>其中load属性是否懒加载由hbm文件中class元素的lazy属性决定</p>
<ol>
<li>lazy=”true”:先返回一个代理对象,使用代理对象的属性时,才去查询数据库(默认值)</li>
<li>lazy=”false”:与get一致,会立即加载数据</li>
</ol>
<h3 id="关联级别加载策略"><a href="#关联级别加载策略" class="headerlink" title="关联级别加载策略"></a>关联级别加载策略</h3><p>在查询有关联关系的数据时,加载一方的数据是否需要将另一方立即查询出<br>默认: 与我关联的数据,在使用时才会加载.</p>
<p>关系中主要由<set>的两个属性：fetch、lazy来设置</set></p>
<blockquote>
<p>缓存</p>
</blockquote>
<p>Hibernate 提供缓存机制</p>
<ol>
<li>一级缓存：session级别缓存,在一次请求中共享数据</li>
<li>二级缓存：sessionFactory级别缓存,整个应用程序共享一个会话工厂,共享一个二级缓存</li>
</ol>
<h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><p>当获得一次会话session,hibernate在session中创建多个集合map,用于存放操作数据<br>如果之后需要相应的数据,优先从session缓存中获取,如果有就使用,有再查询数据库<br>当session关闭时,一级缓存销毁</p>
<p>一级缓存中的快照<br>与一级缓存一样的存放位置,对一级缓存数据备份,保证数据库的数据与一级缓存的数据一致<br>如果一级缓存修改了,在执行commit提交时,将自动刷新一级缓存,执行update语句，将一级缓存的数据更新到数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">session.evict(user);    用于将某个对象从Session的一级缓存中清除</div><div class="line">session.clear();        用于将一级缓存中的所有对象全部清除</div><div class="line">session.refresh(user);  保证一级缓存的数据与数据库的数据保持一致</div><div class="line">session.flush();        手动刷新缓存,默认情况提交commit()刷新</div></pre></td></tr></table></figure>
<h3 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h3><p>SessionFactory的缓存两部分</p>
<ol>
<li>内置缓存：使用一个Map,用于存放配置信息,预定义HQL语句等,提供给框架自己使用,对外只读,不能操作</li>
<li>外置缓存：使用另一个Map,用于存放用户自定义数据,默认不开启,需要第三方实现类。外置缓存即二级缓存</li>
</ol>
<p>由4部分构成:类级别缓存/集合级别缓存/时间戳缓存/查询缓存(二级缓存的第2大部分,三级缓存)</p>
<p>通常使用EHCache:可作为进程范围内的缓存,存放数据的物理介质可以是内存或硬盘,对Hibernatede查询缓存提供了支持</p>
<p>二级缓存的适用场景:很少被修改的数据/不是很重要的数据,允许出现偶尔并发的数据/不会被并发访问的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                    一级缓存                   二级缓存</div><div class="line">缓存范围范围          事务范围          应用范围,当前应用内所有事务共享</div><div class="line">并发访问策略       不会出现并发问题         序提供并发访问策略</div><div class="line">数据过期策略            无              缓存对象的最大数目/最长时间等</div><div class="line">缓存的软件实现       框架包含              第三提供,可插拔集成</div><div class="line">物理介质               内存                    内存和硬盘</div><div class="line">启用方式           默认启用,不可关闭      默认不启用,选择性开启</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
	  
	  
	  
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="hibernate" data-title="Hibernate" data-url="http://lutils.cn/2016/12/11/hibernate/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"lutils"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>





      </div>

    <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div>
    		&copy; 2017 Lutils
    	</div>
		
    </div>
  </div>
</footer>

    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>




<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Web/" style="font-size: 17.5px;">Web</a> <a href="/tags/oj/" style="font-size: 12.5px;">oj</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/并发/" style="font-size: 12.5px;">并发</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.anneke.cn/">卷猫</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>